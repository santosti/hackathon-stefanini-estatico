/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { ToastMessage } from './Models/toast-message.models';
export class AngularBootstrapToastsService {
    constructor() {
        this.toastsList = new BehaviorSubject([]);
        this.defaultTitle = 'Title';
        this.defaultText = 'Message';
        this.defaultDuration = 5000;
        this.minDuration = 300;
        this.maxMessageId = 1;
    }
    /**
     * @return {?}
     */
    get ToastsList$() {
        return this.toastsList.asObservable();
    }
    /**
     * @return {?}
     */
    get DefaultTitle() {
        return this.defaultTitle;
    }
    /**
     * @return {?}
     */
    get DefaultText() {
        return this.defaultText;
    }
    /**
     * @return {?}
     */
    get DefaultDuration() {
        return this.defaultDuration;
    }
    /**
     * Show success toast message
     * @param {?} params
     * @return {?}
     */
    showSimpleToast(params) {
        /** @type {?} */
        const systemParams = {
            id: this.maxMessageId,
            type: 'simple'
        };
        return this.createToast(params, systemParams);
    }
    /**
     * Show toast message with confirmation and decline button variants
     * @param {?} params
     * @return {?}
     */
    showConfirmToast(params) {
        /** @type {?} */
        const systemParams = {
            id: this.maxMessageId,
            type: 'confirm'
        };
        return this.createToast(params, systemParams);
    }
    /**
     * Change Default **Title** for all toasts wich not get `title` property from params when creating
     * @param {?} newTitle
     * @return {?}
     */
    changeDefaultTitle(newTitle) {
        /** @type {?} */
        const validTitle = this.validateTitle(newTitle);
        if (validTitle) {
            this.defaultTitle = validTitle;
        }
    }
    /**
     * Change Default **Text** for all toasts wich not get `text` property from params when creating
     * @param {?} newText
     * @return {?}
     */
    changeDefaultText(newText) {
        /** @type {?} */
        const validText = this.validateText(newText);
        if (validText) {
            this.defaultText = validText;
        }
    }
    /**
     * Change Default **Duration** for all toasts
     * @param {?} duration
     * @return {?}
     */
    changeDefaultDuration(duration) {
        /** @type {?} */
        const validDuration = this.validateDuration(duration);
        if (validDuration) {
            this.defaultDuration = duration;
        }
    }
    /**
     * @private
     * @param {?} params
     * @param {?} systemParams
     * @return {?}
     */
    createToast(params, systemParams) {
        /** @type {?} */
        const messages = this.toastsList.getValue();
        /** @type {?} */
        const validParams = this.validateParams(params);
        /** @type {?} */
        const toast = new ToastMessage(validParams, systemParams);
        messages.push(toast);
        this.maxMessageId++;
        this.toastsList.next(messages);
        /** @type {?} */
        const toastSubscription = toast.ConfirmationResult$.subscribe((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const actualMessages = this.toastsList.getValue();
            for (const [index, message] of actualMessages.entries()) {
                if (message.Id === toast.Id) {
                    actualMessages.splice(index, 1);
                    break;
                }
            }
            this.toastsList.next(actualMessages);
            toastSubscription.unsubscribe();
        }));
        return toast;
    }
    /**
     * @private
     * @param {?} params
     * @return {?}
     */
    validateParams(params) {
        /** @type {?} */
        const newParams = params;
        try {
            newParams.title = this.validateTitle(newParams.title);
        }
        catch (err) {
            newParams.title = this.DefaultTitle;
        }
        try {
            newParams.text = this.validateText(newParams.text);
        }
        catch (err) {
            newParams.text = this.DefaultText;
        }
        try {
            newParams.duration = this.validateDuration(newParams.duration);
        }
        catch (err) {
            newParams.duration = this.DefaultDuration;
        }
        return newParams;
    }
    /**
     * @private
     * @param {?} title
     * @return {?}
     */
    validateTitle(title) {
        if (!title || typeof title !== 'string') {
            throw new Error('Tost default title must be a string with length');
        }
        return title;
    }
    /**
     * @private
     * @param {?} text
     * @return {?}
     */
    validateText(text) {
        if (!text || typeof text !== 'string') {
            throw new Error('Tost default text must be a string with length');
        }
        return text;
    }
    /**
     * @private
     * @param {?} duration
     * @return {?}
     */
    validateDuration(duration) {
        /** @type {?} */
        const durationAsNumber = +duration;
        if (isNaN(durationAsNumber)) {
            throw new Error('Tost duration must be a number');
        }
        else if (durationAsNumber < this.minDuration) {
            throw new Error(`Tost duration must be more than ${this.minDuration} milliseconds`);
        }
        return durationAsNumber;
    }
}
AngularBootstrapToastsService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
AngularBootstrapToastsService.ctorParameters = () => [];
if (false) {
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.toastsList;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.defaultTitle;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.defaultText;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.defaultDuration;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.minDuration;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.maxMessageId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1ib290c3RyYXAtdG9hc3RzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWJvb3RzdHJhcC10b2FzdHMvIiwic291cmNlcyI6WyJsaWIvYW5ndWxhci1ib290c3RyYXAtdG9hc3RzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBQUUsWUFBWSxFQUF5QyxNQUFNLCtCQUErQixDQUFDO0FBR3BHLE1BQU0sT0FBTyw2QkFBNkI7SUEwQnhDO1FBeEJRLGVBQVUsR0FBb0MsSUFBSSxlQUFlLENBQWlCLEVBQUUsQ0FBQyxDQUFDO1FBS3RGLGlCQUFZLEdBQVcsT0FBTyxDQUFDO1FBSy9CLGdCQUFXLEdBQVcsU0FBUyxDQUFDO1FBS2hDLG9CQUFlLEdBQVcsSUFBSSxDQUFDO1FBTS9CLGdCQUFXLEdBQWEsR0FBRyxDQUFDO1FBQzVCLGlCQUFZLEdBQVksQ0FBQyxDQUFDO0lBRWxCLENBQUM7Ozs7SUF2QmpCLElBQVcsV0FBVztRQUNwQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDeEMsQ0FBQzs7OztJQUdELElBQVcsWUFBWTtRQUNyQixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDM0IsQ0FBQzs7OztJQUdELElBQVcsV0FBVztRQUNwQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDMUIsQ0FBQzs7OztJQUdELElBQVcsZUFBZTtRQUN4QixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDOUIsQ0FBQzs7Ozs7O0lBU00sZUFBZSxDQUFFLE1BQTBCOztjQUMxQyxZQUFZLEdBQXNCO1lBQ3RDLEVBQUUsRUFBRSxJQUFJLENBQUMsWUFBWTtZQUNyQixJQUFJLEVBQUUsUUFBUTtTQUNmO1FBRUQsT0FB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dCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBUb2FzdE1lc3NhZ2UsIFRvYXN0TWVzc2FnZVBhcmFtcywgU3lzdGVtVG9hc3RQYXJhbXMgfSBmcm9tICcuL01vZGVscy90b2FzdC1tZXNzYWdlLm1vZGVscyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBBbmd1bGFyQm9vdHN0cmFwVG9hc3RzU2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgdG9hc3RzTGlzdDogQmVoYXZpb3JTdWJqZWN0PFRvYXN0TWVzc2FnZVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VG9hc3RNZXNzYWdlW10+KFtdKTtcclxuICBwdWJsaWMgZ2V0IFRvYXN0c0xpc3QkICgpOiBPYnNlcnZhYmxlPFRvYXN0TWVzc2FnZVtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy50b2FzdHNMaXN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkZWZhdWx0VGl0bGU6IHN0cmluZyA9ICdUaXRsZSc7XHJcbiAgcHVibGljIGdldCBEZWZhdWx0VGl0bGUgKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0VGl0bGU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRlZmF1bHRUZXh0OiBzdHJpbmcgPSAnTWVzc2FnZSc7XHJcbiAgcHVibGljIGdldCBEZWZhdWx0VGV4dCAoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmRlZmF1bHRUZXh0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkZWZhdWx0RHVyYXRpb246IG51bWJlciA9IDUwMDA7XHJcbiAgcHVibGljIGdldCBEZWZhdWx0RHVyYXRpb24gKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0RHVyYXRpb247XHJcbiAgfVxyXG5cclxuXHJcbiAgcHJpdmF0ZSBtaW5EdXJhdGlvbjogbnVtYmVyICAgPSAzMDA7XHJcbiAgcHJpdmF0ZSBtYXhNZXNzYWdlSWQ6IG51bWJlciAgPSAxO1xyXG5cclxuICBjb25zdHJ1Y3RvciAoKSB7fVxyXG5cclxuICAvKiogU2hvdyBzdWNjZXNzIHRvYXN0IG1lc3NhZ2UgKi9cclxuICBwdWJsaWMgc2hvd1NpbXBsZVRvYXN0IChwYXJhbXM6IFRvYXN0TWVzc2FnZVBhcmFtcyk6IFRvYXN0TWVzc2FnZSB7XHJcbiAgICBjb25zdCBzeXN0ZW1QYXJhbXM6IFN5c3RlbVRvYXN0UGFyYW1zID0ge1xyXG4gICAgICBpZDogdGhpcy5tYXhNZXNzYWdlSWQsXHJcbiAgICAgIHR5cGU6ICdzaW1wbGUnXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVRvYXN0KHBhcmFtcywgc3lzdGVtUGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8qKiBTaG93IHRvYXN0IG1lc3NhZ2Ugd2l0aCBjb25maXJtYXRpb24gYW5kIGRlY2xpbmUgYnV0dG9uIHZhcmlhbnRzICovXHJcbiAgcHVibGljIHNob3dDb25maXJtVG9hc3QgKHBhcmFtczogVG9hc3RNZXNzYWdlUGFyYW1zKTogVG9hc3RNZXNzYWdlIHtcclxuICAgIGNvbnN0IHN5c3RlbVBhcmFtczogU3lzdGVtVG9hc3RQYXJhbXMgPSB7XHJcbiAgICAgIGlkOiB0aGlzLm1heE1lc3NhZ2VJZCxcclxuICAgICAgdHlwZTogJ2NvbmZpcm0nXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVRvYXN0KHBhcmFtcywgc3lzdGVtUGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8qKiBDaGFuZ2UgRGVmYXVsdCAqKlRpdGxlKiogZm9yIGFsbCB0b2FzdHMgd2ljaCBub3QgZ2V0IGB0aXRsZWAgcHJvcGVydHkgZnJvbSBwYXJhbXMgd2hlbiBjcmVhdGluZyAqL1xyXG4gIHB1YmxpYyBjaGFuZ2VEZWZhdWx0VGl0bGUgKG5ld1RpdGxlOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHZhbGlkVGl0bGUgPSB0aGlzLnZhbGlkYXRlVGl0bGUobmV3VGl0bGUpO1xyXG5cclxuICAgIGlmICh2YWxpZFRpdGxlKSB7XHJcbiAgICAgIHRoaXMuZGVmYXVsdFRpdGxlID0gdmFsaWRUaXRsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBDaGFuZ2UgRGVmYXVsdCAqKlRleHQqKiBmb3IgYWxsIHRvYXN0cyB3aWNoIG5vdCBnZXQgYHRleHRgIHByb3BlcnR5IGZyb20gcGFyYW1zIHdoZW4gY3JlYXRpbmcgKi9cclxuICBwdWJsaWMgY2hhbmdlRGVmYXVsdFRleHQgKG5ld1RleHQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgdmFsaWRUZXh0ID0gdGhpcy52YWxpZGF0ZVRleHQobmV3VGV4dCk7XHJcblxyXG4gICAgaWYgKHZhbGlkVGV4dCkge1xyXG4gICAgICB0aGlzLmRlZmF1bHRUZXh0ID0gdmFsaWRUZXh0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIENoYW5nZSBEZWZhdWx0ICoqRHVyYXRpb24qKiBmb3IgYWxsIHRvYXN0cyAqL1xyXG4gIHB1YmxpYyBjaGFuZ2VEZWZhdWx0RHVyYXRpb24gKGR1cmF0aW9uOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IHZhbGlkRHVyYXRpb24gPSB0aGlzLnZhbGlkYXRlRHVyYXRpb24oZHVyYXRpb24pO1xyXG5cclxuICAgIGlmICh2YWxpZER1cmF0aW9uKSB7XHJcbiAgICAgIHRoaXMuZGVmYXVsdER1cmF0aW9uID0gZHVyYXRpb247XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZVRvYXN0IChwYXJhbXM6IFRvYXN0TWVzc2FnZVBhcmFtcywgc3lzdGVtUGFyYW1zOiBTeXN0ZW1Ub2FzdFBhcmFtcyk6IFRvYXN0TWVzc2FnZSB7XHJcbiAgICBjb25zdCBtZXNzYWdlcyAgICA9IHRoaXMudG9hc3RzTGlzdC5nZXRWYWx1ZSgpO1xyXG4gICAgY29uc3QgdmFsaWRQYXJhbXMgPSB0aGlzLnZhbGlkYXRlUGFyYW1zKHBhcmFtcyk7XHJcbiAgICBjb25zdCB0b2FzdCAgICAgICA9IG5ldyBUb2FzdE1lc3NhZ2UodmFsaWRQYXJhbXMsIHN5c3RlbVBhcmFtcyk7XHJcblxyXG4gICAgbWVzc2FnZXMucHVzaCh0b2FzdCk7XHJcblxyXG4gICAgdGhpcy5tYXhNZXNzYWdlSWQrKztcclxuICAgIHRoaXMudG9hc3RzTGlzdC5uZXh0KG1lc3NhZ2VzKTtcclxuXHJcbiAgICBjb25zdCB0b2FzdFN1YnNjcmlwdGlvbiA9IHRvYXN0LkNvbmZpcm1hdGlvblJlc3VsdCQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgY29uc3QgYWN0dWFsTWVzc2FnZXMgPSB0aGlzLnRvYXN0c0xpc3QuZ2V0VmFsdWUoKTtcclxuXHJcbiAgICAgIGZvciAoY29uc3QgW2luZGV4LCBtZXNzYWdlXSBvZiBhY3R1YWxNZXNzYWdlcy5lbnRyaWVzKCkpIHtcclxuICAgICAgICBpZiAobWVzc2FnZS5JZCA9PT0gdG9hc3QuSWQpIHtcclxuICAgICAgICAgIGFjdHVhbE1lc3NhZ2VzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMudG9hc3RzTGlzdC5uZXh0KGFjdHVhbE1lc3NhZ2VzKTtcclxuXHJcbiAgICAgIHRvYXN0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdG9hc3Q7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZhbGlkYXRlUGFyYW1zIChwYXJhbXM6IFRvYXN0TWVzc2FnZVBhcmFtcyk6IFRvYXN0TWVzc2FnZVBhcmFtcyB7XHJcbiAgICBjb25zdCBuZXdQYXJhbXMgPSBwYXJhbXM7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgbmV3UGFyYW1zLnRpdGxlID0gdGhpcy52YWxpZGF0ZVRpdGxlKG5ld1BhcmFtcy50aXRsZSk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgbmV3UGFyYW1zLnRpdGxlID0gdGhpcy5EZWZhdWx0VGl0bGU7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgbmV3UGFyYW1zLnRleHQgPSB0aGlzLnZhbGlkYXRlVGV4dChuZXdQYXJhbXMudGV4dCk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgbmV3UGFyYW1zLnRleHQgPSB0aGlzLkRlZmF1bHRUZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIG5ld1BhcmFtcy5kdXJhdGlvbiA9IHRoaXMudmFsaWRhdGVEdXJhdGlvbihuZXdQYXJhbXMuZHVyYXRpb24pO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIG5ld1BhcmFtcy5kdXJhdGlvbiA9IHRoaXMuRGVmYXVsdER1cmF0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXdQYXJhbXM7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZhbGlkYXRlVGl0bGUgKHRpdGxlOiBzdHJpbmcpIHtcclxuICAgIGlmICghdGl0bGUgfHwgdHlwZW9mIHRpdGxlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rvc3QgZGVmYXVsdCB0aXRsZSBtdXN0IGJlIGEgc3RyaW5nIHdpdGggbGVuZ3RoJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRpdGxlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2YWxpZGF0ZVRleHQgKHRleHQ6IHN0cmluZykge1xyXG4gICAgaWYgKCF0ZXh0IHx8IHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rvc3QgZGVmYXVsdCB0ZXh0IG11c3QgYmUgYSBzdHJpbmcgd2l0aCBsZW5ndGgnKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGV4dDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmFsaWRhdGVEdXJhdGlvbiAoZHVyYXRpb246IG51bWJlcikge1xyXG4gICAgY29uc3QgZHVyYXRpb25Bc051bWJlcjogbnVtYmVyID0gK2R1cmF0aW9uO1xyXG5cclxuICAgIGlmIChpc05hTihkdXJhdGlvbkFzTnVtYmVyKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rvc3QgZHVyYXRpb24gbXVzdCBiZSBhIG51bWJlcicpO1xyXG4gICAgfSBlbHNlIGlmIChkdXJhdGlvbkFzTnVtYmVyIDwgdGhpcy5taW5EdXJhdGlvbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvc3QgZHVyYXRpb24gbXVzdCBiZSBtb3JlIHRoYW4gJHt0aGlzLm1pbkR1cmF0aW9ufSBtaWxsaXNlY29uZHNgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZHVyYXRpb25Bc051bWJlcjtcclxuICB9XHJcbn1cclxuIl19