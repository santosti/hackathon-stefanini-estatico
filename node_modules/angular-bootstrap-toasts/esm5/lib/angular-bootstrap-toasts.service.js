/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { ToastMessage } from './Models/toast-message.models';
var AngularBootstrapToastsService = /** @class */ (function () {
    function AngularBootstrapToastsService() {
        this.toastsList = new BehaviorSubject([]);
        this.defaultTitle = 'Title';
        this.defaultText = 'Message';
        this.defaultDuration = 5000;
        this.minDuration = 300;
        this.maxMessageId = 1;
    }
    Object.defineProperty(AngularBootstrapToastsService.prototype, "ToastsList$", {
        get: /**
         * @return {?}
         */
        function () {
            return this.toastsList.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AngularBootstrapToastsService.prototype, "DefaultTitle", {
        get: /**
         * @return {?}
         */
        function () {
            return this.defaultTitle;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AngularBootstrapToastsService.prototype, "DefaultText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.defaultText;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AngularBootstrapToastsService.prototype, "DefaultDuration", {
        get: /**
         * @return {?}
         */
        function () {
            return this.defaultDuration;
        },
        enumerable: true,
        configurable: true
    });
    /** Show success toast message */
    /**
     * Show success toast message
     * @param {?} params
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.showSimpleToast = /**
     * Show success toast message
     * @param {?} params
     * @return {?}
     */
    function (params) {
        /** @type {?} */
        var systemParams = {
            id: this.maxMessageId,
            type: 'simple'
        };
        return this.createToast(params, systemParams);
    };
    /** Show toast message with confirmation and decline button variants */
    /**
     * Show toast message with confirmation and decline button variants
     * @param {?} params
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.showConfirmToast = /**
     * Show toast message with confirmation and decline button variants
     * @param {?} params
     * @return {?}
     */
    function (params) {
        /** @type {?} */
        var systemParams = {
            id: this.maxMessageId,
            type: 'confirm'
        };
        return this.createToast(params, systemParams);
    };
    /** Change Default **Title** for all toasts wich not get `title` property from params when creating */
    /**
     * Change Default **Title** for all toasts wich not get `title` property from params when creating
     * @param {?} newTitle
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.changeDefaultTitle = /**
     * Change Default **Title** for all toasts wich not get `title` property from params when creating
     * @param {?} newTitle
     * @return {?}
     */
    function (newTitle) {
        /** @type {?} */
        var validTitle = this.validateTitle(newTitle);
        if (validTitle) {
            this.defaultTitle = validTitle;
        }
    };
    /** Change Default **Text** for all toasts wich not get `text` property from params when creating */
    /**
     * Change Default **Text** for all toasts wich not get `text` property from params when creating
     * @param {?} newText
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.changeDefaultText = /**
     * Change Default **Text** for all toasts wich not get `text` property from params when creating
     * @param {?} newText
     * @return {?}
     */
    function (newText) {
        /** @type {?} */
        var validText = this.validateText(newText);
        if (validText) {
            this.defaultText = validText;
        }
    };
    /** Change Default **Duration** for all toasts */
    /**
     * Change Default **Duration** for all toasts
     * @param {?} duration
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.changeDefaultDuration = /**
     * Change Default **Duration** for all toasts
     * @param {?} duration
     * @return {?}
     */
    function (duration) {
        /** @type {?} */
        var validDuration = this.validateDuration(duration);
        if (validDuration) {
            this.defaultDuration = duration;
        }
    };
    /**
     * @private
     * @param {?} params
     * @param {?} systemParams
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.createToast = /**
     * @private
     * @param {?} params
     * @param {?} systemParams
     * @return {?}
     */
    function (params, systemParams) {
        var _this = this;
        /** @type {?} */
        var messages = this.toastsList.getValue();
        /** @type {?} */
        var validParams = this.validateParams(params);
        /** @type {?} */
        var toast = new ToastMessage(validParams, systemParams);
        messages.push(toast);
        this.maxMessageId++;
        this.toastsList.next(messages);
        /** @type {?} */
        var toastSubscription = toast.ConfirmationResult$.subscribe((/**
         * @return {?}
         */
        function () {
            var e_1, _a;
            /** @type {?} */
            var actualMessages = _this.toastsList.getValue();
            try {
                for (var _b = tslib_1.__values(actualMessages.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var _d = tslib_1.__read(_c.value, 2), index = _d[0], message = _d[1];
                    if (message.Id === toast.Id) {
                        actualMessages.splice(index, 1);
                        break;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
            _this.toastsList.next(actualMessages);
            toastSubscription.unsubscribe();
        }));
        return toast;
    };
    /**
     * @private
     * @param {?} params
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.validateParams = /**
     * @private
     * @param {?} params
     * @return {?}
     */
    function (params) {
        /** @type {?} */
        var newParams = params;
        try {
            newParams.title = this.validateTitle(newParams.title);
        }
        catch (err) {
            newParams.title = this.DefaultTitle;
        }
        try {
            newParams.text = this.validateText(newParams.text);
        }
        catch (err) {
            newParams.text = this.DefaultText;
        }
        try {
            newParams.duration = this.validateDuration(newParams.duration);
        }
        catch (err) {
            newParams.duration = this.DefaultDuration;
        }
        return newParams;
    };
    /**
     * @private
     * @param {?} title
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.validateTitle = /**
     * @private
     * @param {?} title
     * @return {?}
     */
    function (title) {
        if (!title || typeof title !== 'string') {
            throw new Error('Tost default title must be a string with length');
        }
        return title;
    };
    /**
     * @private
     * @param {?} text
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.validateText = /**
     * @private
     * @param {?} text
     * @return {?}
     */
    function (text) {
        if (!text || typeof text !== 'string') {
            throw new Error('Tost default text must be a string with length');
        }
        return text;
    };
    /**
     * @private
     * @param {?} duration
     * @return {?}
     */
    AngularBootstrapToastsService.prototype.validateDuration = /**
     * @private
     * @param {?} duration
     * @return {?}
     */
    function (duration) {
        /** @type {?} */
        var durationAsNumber = +duration;
        if (isNaN(durationAsNumber)) {
            throw new Error('Tost duration must be a number');
        }
        else if (durationAsNumber < this.minDuration) {
            throw new Error("Tost duration must be more than " + this.minDuration + " milliseconds");
        }
        return durationAsNumber;
    };
    AngularBootstrapToastsService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    AngularBootstrapToastsService.ctorParameters = function () { return []; };
    return AngularBootstrapToastsService;
}());
export { AngularBootstrapToastsService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.toastsList;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.defaultTitle;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.defaultText;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.defaultDuration;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.minDuration;
    /**
     * @type {?}
     * @private
     */
    AngularBootstrapToastsService.prototype.maxMessageId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1ib290c3RyYXAtdG9hc3RzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWJvb3RzdHJhcC10b2FzdHMvIiwic291cmNlcyI6WyJsaWIvYW5ndWxhci1ib290c3RyYXAtdG9hc3RzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDbkQsT0FBTyxFQUFFLFlBQVksRUFBeUMsTUFBTSwrQkFBK0IsQ0FBQztBQUVwRztJQTJCRTtRQXhCUSxlQUFVLEdBQW9DLElBQUksZUFBZSxDQUFpQixFQUFFLENBQUMsQ0FBQztRQUt0RixpQkFBWSxHQUFXLE9BQU8sQ0FBQztRQUsvQixnQkFBVyxHQUFXLFNBQVMsQ0FBQztRQUtoQyxvQkFBZSxHQUFXLElBQUksQ0FBQztRQU0vQixnQkFBVyxHQUFhLEdBQUcsQ0FBQztRQUM1QixpQkFBWSxHQUFZLENBQUMsQ0FBQztJQUVsQixDQUFDO0lBdkJqQixzQkFBVyxzREFBVzs7OztRQUF0QjtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN4QyxDQUFDOzs7T0FBQTtJQUdELHNCQUFXLHVEQUFZOzs7O1FBQXZCO1lBQ0UsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQzNCLENBQUM7OztPQUFBO0lBR0Qsc0JBQVcsc0RBQVc7Ozs7UUFBdEI7WUFDRSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDMUIsQ0FBQzs7O09BQUE7SUFHRCxzQkFBVywwREFBZTs7OztRQUExQjtZQUNFLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQztRQUM5QixDQUFDOzs7T0FBQTtJQVFELGlDQUFpQzs7Ozs7O0lBQzFCLHVEQUFlOzs7OztJQUF0QixVQUF3QixNQUEwQjs7WUFDMUMsWUFBWSxHQUFzQjtZ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LGdCQUFnQixHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDOUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQ0FBbUMsSUFBSSxDQUFDLFdBQVcsa0JBQWUsQ0FBQyxDQUFDO1NBQ3JGO1FBRUQsT0FBTyxnQkFBZ0IsQ0FBQztJQUMxQixDQUFDOztnQkExSkYsVUFBVTs7OztJQTJKWCxvQ0FBQztDQUFBLEFBM0pELElBMkpDO1NBMUpZLDZCQUE2Qjs7Ozs7O0lBRXhDLG1EQUE4Rjs7Ozs7SUFLOUYscURBQXVDOzs7OztJQUt2QyxvREFBd0M7Ozs7O0lBS3hDLHdEQUF1Qzs7Ozs7SUFNdkMsb0RBQW9DOzs7OztJQUNwQyxxREFBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBUb2FzdE1lc3NhZ2UsIFRvYXN0TWVzc2FnZVBhcmFtcywgU3lzdGVtVG9hc3RQYXJhbXMgfSBmcm9tICcuL01vZGVscy90b2FzdC1tZXNzYWdlLm1vZGVscyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBBbmd1bGFyQm9vdHN0cmFwVG9hc3RzU2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgdG9hc3RzTGlzdDogQmVoYXZpb3JTdWJqZWN0PFRvYXN0TWVzc2FnZVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VG9hc3RNZXNzYWdlW10+KFtdKTtcclxuICBwdWJsaWMgZ2V0IFRvYXN0c0xpc3QkICgpOiBPYnNlcnZhYmxlPFRvYXN0TWVzc2FnZVtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy50b2FzdHNMaXN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkZWZhdWx0VGl0bGU6IHN0cmluZyA9ICdUaXRsZSc7XHJcbiAgcHVibGljIGdldCBEZWZhdWx0VGl0bGUgKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0VGl0bGU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRlZmF1bHRUZXh0OiBzdHJpbmcgPSAnTWVzc2FnZSc7XHJcbiAgcHVibGljIGdldCBEZWZhdWx0VGV4dCAoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmRlZmF1bHRUZXh0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkZWZhdWx0RHVyYXRpb246IG51bWJlciA9IDUwMDA7XHJcbiAgcHVibGljIGdldCBEZWZhdWx0RHVyYXRpb24gKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0RHVyYXRpb247XHJcbiAgfVxyXG5cclxuXHJcbiAgcHJpdmF0ZSBtaW5EdXJhdGlvbjogbnVtYmVyICAgPSAzMDA7XHJcbiAgcHJpdmF0ZSBtYXhNZXNzYWdlSWQ6IG51bWJlciAgPSAxO1xyXG5cclxuICBjb25zdHJ1Y3RvciAoKSB7fVxyXG5cclxuICAvKiogU2hvdyBzdWNjZXNzIHRvYXN0IG1lc3NhZ2UgKi9cclxuICBwdWJsaWMgc2hvd1NpbXBsZVRvYXN0IChwYXJhbXM6IFRvYXN0TWVzc2FnZVBhcmFtcyk6IFRvYXN0TWVzc2FnZSB7XHJcbiAgICBjb25zdCBzeXN0ZW1QYXJhbXM6IFN5c3RlbVRvYXN0UGFyYW1zID0ge1xyXG4gICAgICBpZDogdGhpcy5tYXhNZXNzYWdlSWQsXHJcbiAgICAgIHR5cGU6ICdzaW1wbGUnXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVRvYXN0KHBhcmFtcywgc3lzdGVtUGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8qKiBTaG93IHRvYXN0IG1lc3NhZ2Ugd2l0aCBjb25maXJtYXRpb24gYW5kIGRlY2xpbmUgYnV0dG9uIHZhcmlhbnRzICovXHJcbiAgcHVibGljIHNob3dDb25maXJtVG9hc3QgKHBhcmFtczogVG9hc3RNZXNzYWdlUGFyYW1zKTogVG9hc3RNZXNzYWdlIHtcclxuICAgIGNvbnN0IHN5c3RlbVBhcmFtczogU3lzdGVtVG9hc3RQYXJhbXMgPSB7XHJcbiAgICAgIGlkOiB0aGlzLm1heE1lc3NhZ2VJZCxcclxuICAgICAgdHlwZTogJ2NvbmZpcm0nXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVRvYXN0KHBhcmFtcywgc3lzdGVtUGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8qKiBDaGFuZ2UgRGVmYXVsdCAqKlRpdGxlKiogZm9yIGFsbCB0b2FzdHMgd2ljaCBub3QgZ2V0IGB0aXRsZWAgcHJvcGVydHkgZnJvbSBwYXJhbXMgd2hlbiBjcmVhdGluZyAqL1xyXG4gIHB1YmxpYyBjaGFuZ2VEZWZhdWx0VGl0bGUgKG5ld1RpdGxlOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHZhbGlkVGl0bGUgPSB0aGlzLnZhbGlkYXRlVGl0bGUobmV3VGl0bGUpO1xyXG5cclxuICAgIGlmICh2YWxpZFRpdGxlKSB7XHJcbiAgICAgIHRoaXMuZGVmYXVsdFRpdGxlID0gdmFsaWRUaXRsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBDaGFuZ2UgRGVmYXVsdCAqKlRleHQqKiBmb3IgYWxsIHRvYXN0cyB3aWNoIG5vdCBnZXQgYHRleHRgIHByb3BlcnR5IGZyb20gcGFyYW1zIHdoZW4gY3JlYXRpbmcgKi9cclxuICBwdWJsaWMgY2hhbmdlRGVmYXVsdFRleHQgKG5ld1RleHQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgdmFsaWRUZXh0ID0gdGhpcy52YWxpZGF0ZVRleHQobmV3VGV4dCk7XHJcblxyXG4gICAgaWYgKHZhbGlkVGV4dCkge1xyXG4gICAgICB0aGlzLmRlZmF1bHRUZXh0ID0gdmFsaWRUZXh0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIENoYW5nZSBEZWZhdWx0ICoqRHVyYXRpb24qKiBmb3IgYWxsIHRvYXN0cyAqL1xyXG4gIHB1YmxpYyBjaGFuZ2VEZWZhdWx0RHVyYXRpb24gKGR1cmF0aW9uOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IHZhbGlkRHVyYXRpb24gPSB0aGlzLnZhbGlkYXRlRHVyYXRpb24oZHVyYXRpb24pO1xyXG5cclxuICAgIGlmICh2YWxpZER1cmF0aW9uKSB7XHJcbiAgICAgIHRoaXMuZGVmYXVsdER1cmF0aW9uID0gZHVyYXRpb247XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZVRvYXN0IChwYXJhbXM6IFRvYXN0TWVzc2FnZVBhcmFtcywgc3lzdGVtUGFyYW1zOiBTeXN0ZW1Ub2FzdFBhcmFtcyk6IFRvYXN0TWVzc2FnZSB7XHJcbiAgICBjb25zdCBtZXNzYWdlcyAgICA9IHRoaXMudG9hc3RzTGlzdC5nZXRWYWx1ZSgpO1xyXG4gICAgY29uc3QgdmFsaWRQYXJhbXMgPSB0aGlzLnZhbGlkYXRlUGFyYW1zKHBhcmFtcyk7XHJcbiAgICBjb25zdCB0b2FzdCAgICAgICA9IG5ldyBUb2FzdE1lc3NhZ2UodmFsaWRQYXJhbXMsIHN5c3RlbVBhcmFtcyk7XHJcblxyXG4gICAgbWVzc2FnZXMucHVzaCh0b2FzdCk7XHJcblxyXG4gICAgdGhpcy5tYXhNZXNzYWdlSWQrKztcclxuICAgIHRoaXMudG9hc3RzTGlzdC5uZXh0KG1lc3NhZ2VzKTtcclxuXHJcbiAgICBjb25zdCB0b2FzdFN1YnNjcmlwdGlvbiA9IHRvYXN0LkNvbmZpcm1hdGlvblJlc3VsdCQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgY29uc3QgYWN0dWFsTWVzc2FnZXMgPSB0aGlzLnRvYXN0c0xpc3QuZ2V0VmFsdWUoKTtcclxuXHJcbiAgICAgIGZvciAoY29uc3QgW2luZGV4LCBtZXNzYWdlXSBvZiBhY3R1YWxNZXNzYWdlcy5lbnRyaWVzKCkpIHtcclxuICAgICAgICBpZiAobWVzc2FnZS5JZCA9PT0gdG9hc3QuSWQpIHtcclxuICAgICAgICAgIGFjdHVhbE1lc3NhZ2VzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMudG9hc3RzTGlzdC5uZXh0KGFjdHVhbE1lc3NhZ2VzKTtcclxuXHJcbiAgICAgIHRvYXN0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdG9hc3Q7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZhbGlkYXRlUGFyYW1zIChwYXJhbXM6IFRvYXN0TWVzc2FnZVBhcmFtcyk6IFRvYXN0TWVzc2FnZVBhcmFtcyB7XHJcbiAgICBjb25zdCBuZXdQYXJhbXMgPSBwYXJhbXM7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgbmV3UGFyYW1zLnRpdGxlID0gdGhpcy52YWxpZGF0ZVRpdGxlKG5ld1BhcmFtcy50aXRsZSk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgbmV3UGFyYW1zLnRpdGxlID0gdGhpcy5EZWZhdWx0VGl0bGU7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgbmV3UGFyYW1zLnRleHQgPSB0aGlzLnZhbGlkYXRlVGV4dChuZXdQYXJhbXMudGV4dCk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgbmV3UGFyYW1zLnRleHQgPSB0aGlzLkRlZmF1bHRUZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIG5ld1BhcmFtcy5kdXJhdGlvbiA9IHRoaXMudmFsaWRhdGVEdXJhdGlvbihuZXdQYXJhbXMuZHVyYXRpb24pO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIG5ld1BhcmFtcy5kdXJhdGlvbiA9IHRoaXMuRGVmYXVsdER1cmF0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXdQYXJhbXM7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZhbGlkYXRlVGl0bGUgKHRpdGxlOiBzdHJpbmcpIHtcclxuICAgIGlmICghdGl0bGUgfHwgdHlwZW9mIHRpdGxlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rvc3QgZGVmYXVsdCB0aXRsZSBtdXN0IGJlIGEgc3RyaW5nIHdpdGggbGVuZ3RoJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRpdGxlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2YWxpZGF0ZVRleHQgKHRleHQ6IHN0cmluZykge1xyXG4gICAgaWYgKCF0ZXh0IHx8IHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rvc3QgZGVmYXVsdCB0ZXh0IG11c3QgYmUgYSBzdHJpbmcgd2l0aCBsZW5ndGgnKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGV4dDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmFsaWRhdGVEdXJhdGlvbiAoZHVyYXRpb246IG51bWJlcikge1xyXG4gICAgY29uc3QgZHVyYXRpb25Bc051bWJlcjogbnVtYmVyID0gK2R1cmF0aW9uO1xyXG5cclxuICAgIGlmIChpc05hTihkdXJhdGlvbkFzTnVtYmVyKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rvc3QgZHVyYXRpb24gbXVzdCBiZSBhIG51bWJlcicpO1xyXG4gICAgfSBlbHNlIGlmIChkdXJhdGlvbkFzTnVtYmVyIDwgdGhpcy5taW5EdXJhdGlvbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvc3QgZHVyYXRpb24gbXVzdCBiZSBtb3JlIHRoYW4gJHt0aGlzLm1pbkR1cmF0aW9ufSBtaWxsaXNlY29uZHNgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZHVyYXRpb25Bc051bWJlcjtcclxuICB9XHJcbn1cclxuIl19